<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Uganda District Map - Enhanced</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        #container {
            display: flex;
            height: 100vh;
        }
        #sidebar {
            width: 300px;
            padding: 16px;
            border-right: 1px solid #ddd;
            background: #f7f7f9;
        }
        h2 { margin-top: 0; }
        input, select, button {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #1e4fd3;
        }
        #map { flex: 1; }
        .district-label {
            background: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 11px;
            border: 1px solid #777;
        }
    </style>

</head>

<body>

<div id="container">

    <div id="sidebar">
        <h2>Uganda District Map</h2>

        <input type="text" id="searchInput" placeholder="Search districtâ€¦" />
        <button id="searchBtn">Search</button>

        <select id="districtSelect">
            <option value="">-- Select District --</option>
        </select>

        <h3>District Info</h3>
        <div id="info">Click or search for a district.</div>
    </div>

    <div id="map"></div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    var map = L.map('map').setView([1.4, 32.3], 7);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18
    }).addTo(map);

    let districtLayer;
    let selectedLayer = null;
    let selectedLabel = null;

    const searchInput = document.getElementById("searchInput");
    const searchBtn = document.getElementById("searchBtn");
    const districtSelect = document.getElementById("districtSelect");
    const infoDiv = document.getElementById("info");

    // ---------- Default style ----------
    function defaultStyle() {
        return {
            weight: 1,
            color: "#1d4ed8",
            fillColor: "#60a5fa",
            fillOpacity: 0.35
        };
    }

    // ---------- Highlight selected district ----------
    function selectedStyle() {
        return {
            weight: 3,
            color: "#d97706",
            fillColor: "#f59e0b",
            fillOpacity: 0.55
        };
    }

    // ---------- Update sidebar ----------
    function updateSidebar(props) {
        infoDiv.innerHTML = `
            <b>District:</b> ${props.d}<br>
        `;
    }

    // ---------- Show label only for selected district ----------
    function showLabel(layer) {
        if (selectedLabel) map.removeLayer(selectedLabel);

        const center = layer.getBounds().getCenter();
        const name = layer.feature.properties.d;

        selectedLabel = L.marker(center, {
            icon: L.divIcon({
                className: "district-label",
                html: name
            })
        }).addTo(map);
    }

    // ---------- Clear previous highlights ----------
    function clearPreviousSelection() {
        if (selectedLayer) {
            districtLayer.resetStyle(selectedLayer);
        }
        if (selectedLabel) {
            map.removeLayer(selectedLabel);
            selectedLabel = null;
        }
    }

    // ---------- Apply selection ----------
    function focusOnLayer(layer) {
        clearPreviousSelection();

        selectedLayer = layer;
        layer.setStyle(selectedStyle());

        showLabel(layer);
        updateSidebar(layer.feature.properties);

        map.fitBounds(layer.getBounds(), { padding: [20, 20] });
        layer.openPopup();
    }

    // ---------- Load GeoJSON ----------
    fetch("districts.geojson")
        .then(res => res.json())
        .then(data => {

            function onEachFeature(feature, layer) {
                const name = feature.properties.d;

                layer.bindPopup(`<b>${name}</b>`);

                layer.on("click", function () {
                    focusOnLayer(layer);
                });

                // Hover effect (only when not selected)
                layer.on("mouseover", function () {
                    if (layer !== selectedLayer) {
                        layer.setStyle({ weight: 3, fillOpacity: 0.5 });
                    }
                });

                layer.on("mouseout", function () {
                    if (layer !== selectedLayer) {
                        districtLayer.resetStyle(layer);
                    }
                });
            }

            districtLayer = L.geoJSON(data, {
                style: defaultStyle,
                onEachFeature: onEachFeature
            }).addTo(map);

            // Populate dropdown
            data.features.forEach(f => {
                const opt = document.createElement("option");
                opt.value = f.properties.d;
                opt.textContent = f.properties.d;
                districtSelect.appendChild(opt);
            });

            // Dropdown event
            districtSelect.onchange = function () {
                const selected = this.value;
                districtLayer.eachLayer(layer => {
                    if (layer.feature.properties.d === selected) {
                        focusOnLayer(layer);
                    }
                });
            };

            // Search function
            function searchDistrict() {
                const query = searchInput.value.trim().toLowerCase();
                if (!query) return;

                districtLayer.eachLayer(layer => {
                    const name = layer.feature.properties.d.toLowerCase();
                    if (name.includes(query)) {
                        focusOnLayer(layer);
                    }
                });
            }

            searchBtn.onclick = searchDistrict;
            searchInput.onkeydown = function (e) {
                if (e.key === "Enter") searchDistrict();
            };
        });
</script>

</body>
</html>
